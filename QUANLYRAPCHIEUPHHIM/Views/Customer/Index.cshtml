@model QUANLYRAPCHIEUPHHIM.ViewModels.HomePageViewModel
@{
	ViewData["Title"] = "Trang chủ";
	Layout = "_Layout";
}

   <div class="container my-4">
       <div id="bannerCarousel" class="carousel slide" data-bs-ride="carousel">
           <div class="carousel-inner rounded-3 shadow">
               @for (int i = 0; i < Model.Banners.Count; i++)
               {
                   <div class="carousel-item @(i == 0 ? "active" : "")">
                       <img src="@Model.Banners[i]" class="d-block w-100" style="height:400px;object-fit:cover;" alt="Banner @(i+1)" />
                   </div>
               }
           </div>
           <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
               <span class="carousel-control-prev-icon"></span>
               <span class="visually-hidden">Previous</span>
           </button>
           <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
               <span class="carousel-control-next-icon"></span>
               <span class="visually-hidden">Next</span>
           </button>
           <div class="carousel-indicators">
               @for (int i = 0; i < Model.Banners.Count; i++)
               {
                   <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")" aria-label="Slide @(i+1)"></button>
               }
           </div>
       </div>
   </div>
    <div class="container mt-4">
       <div class="d-flex align-items-center mb-3">
           <h3 class="me-4 fw-bold" style="letter-spacing:1px;">PHIM</h3>
           <ul class="nav nav-tabs border-0" id="movieTab">
               <li class="nav-item">
                   <a class="nav-link active fw-bold" data-bs-toggle="tab" href="#nowShowingTab">Đang chiếu</a>
               </li>
               <li class="nav-item">
                   <a class="nav-link fw-bold" data-bs-toggle="tab" href="#comingSoonTab">Sắp chiếu</a>
               </li>
               <li class="nav-item">
                   <a class="nav-link fw-bold" data-bs-toggle="tab" href="#imaxTab">Phim IMAX</a>
               </li>
           </ul>
           <span class="ms-auto text-primary fw-bold" style="cursor:pointer;">
               <i class="fa-solid fa-location-dot"></i> TP Đà nẵng
           </span>
       </div>
    <div class="tab-content">
        <div class="tab-pane fade show active" id="nowShowingTab">
            <div class="row">
                @foreach (var movie in Model.NowShowing.Take(8))
                {
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                        <div class="movie-card-custom card h-100 shadow-sm border-0 position-relative overflow-hidden">
                            <div class="poster-wrapper position-relative">
                                <img src="@movie.PosterUrl" class="card-img-top" style="height:510px;width:100%;object-fit:cover;aspect-ratio:2/3;border-radius:18px;" alt="@movie.Title" />
                                <div class="movie-overlay-custom d-flex flex-column justify-content-center align-items-center gap-2">
                                    <a href="/Booking/Quick?movieId=@movie.MovieId" class="btn btn-danger btn-md w-75 rounded-pill fw-bold">
                                        <i class="fa-solid fa-ticket"></i> Mua vé
                                    </a>
                                    @if (!string.IsNullOrEmpty(movie.TrailerUrl))
                                    {
                                        <button class="btn btn-outline-light btn-md w-75 rounded-pill fw-bold" onclick="showTrailer('@movie.TrailerUrl')">
                                            <i class="fa-solid fa-play"></i> Trailer
                                        </button>
                                    }
                                </div>
                                <div class="badge-group position-absolute end-0 bottom-0 m-3 d-flex flex-column align-items-end gap-2">
                                    <span class="badge bg-warning text-dark fs-6 shadow"><i class="fa-solid fa-star"></i> @movie.Rating</span>
                                    <span class="badge bg-orange text-white fs-6 shadow">@movie.AgeLimit</span>
                                </div>
                            </div>
                            <div class="card-body text-center p-2">
                                <h6 class="card-title fw-bold mb-1" style="min-height:40px;font-size:1.1rem;">@movie.Title</h6>
                                <!-- Subtitle or extra info can go here if needed -->
                            </div>
                        </div>
                    </div>
                }
            </div>
            @if (Model.NowShowing.Count > 8)
            {
                <div class="text-center">
                    <a href="/Movies?type=nowshowing" class="btn btn-outline-primary">Xem thêm</a>
                </div>
            }
        </div>
        <div class="tab-pane fade" id="comingSoonTab">
	        <div class="row">
		        @foreach (var movie in Model.ComingSoon.Take(8))
		        {
			        <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
				        <div class="movie-card card h-100 shadow-sm border-0 position-relative overflow-hidden">
					        <img src="@movie.PosterUrl" class="card-img-top" style="height:510px;width:100%;object-fit:cover;aspect-ratio:2/3;" alt="@movie.Title" />
					        <div class="card-body">
						        <h6 class="card-title fw-bold mb-1" style="min-height:40px;">@movie.Title</h6>
						        <div class="d-flex align-items-center mb-2">
							        <span class="badge bg-warning text-dark me-2"><i class="fa-solid fa-star"></i> @movie.Rating</span>
							        <span class="badge bg-orange text-white">@movie.AgeLimit</span>
						        </div>
					        </div>
					        <div class="movie-overlay d-flex flex-column justify-content-center align-items-center">
						        <a href="/Booking/Quick?movieId=@movie.MovieId" class="btn btn-danger btn-sm mb-2 w-75">
							        <i class="fa-solid fa-ticket"></i> Mua vé
						        </a>
						        @if (!string.IsNullOrEmpty(movie.TrailerUrl))
						        {
							        <button class="btn btn-outline-light btn-sm w-75" onclick="showTrailer('@movie.TrailerUrl')">
								        <i class="fa-solid fa-play"></i> Trailer
							        </button>
						        }
					        </div>
				        </div>
			        </div>
		        }
	        </div>
            @if (Model.ComingSoon.Count > 8)
            {
                <div class="text-center">
                    <a href="/Movies?type=comingsoon" class="btn btn-outline-primary">Xem thêm</a>
                </div>
            }
        </div>
        <div class="tab-pane fade" id="imaxTab">
            <div class="row">
                @foreach (var movie in Model.ImaxMovies.Take(8))
                {
                    <div class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4">
                        <div class="movie-card card h-100 shadow-sm border-0 position-relative overflow-hidden">
                            <img src="@movie.PosterUrl" class="card-img-top" style="height:510px;width:100%;object-fit:cover;aspect-ratio:2/3;" alt="@movie.Title" />
                            <div class="card-body">
                                <h6 class="card-title fw-bold mb-1" style="min-height:40px;">@movie.Title</h6>
                                <div class="d-flex align-items-center mb-2">
                                    <span class="badge bg-warning text-dark me-2"><i class="fa-solid fa-star"></i> @movie.Rating</span>
                                    <span class="badge bg-orange text-white">@movie.AgeLimit</span>
                                </div>
                            </div>
                            <div class="movie-overlay d-flex flex-column justify-content-center align-items-center">
                                <a href="/Booking/Quick?movieId=@movie.MovieId" class="btn btn-danger btn-sm mb-2 w-75">
                                    <i class="fa-solid fa-ticket"></i> Mua vé
                                </a>
                                @if (!string.IsNullOrEmpty(movie.TrailerUrl))
                                {
                                    <button class="btn btn-outline-light btn-sm w-75" onclick="showTrailer('@movie.TrailerUrl')">
                                        <i class="fa-solid fa-play"></i> Trailer
                                    </button>
                                }
                            </div>
                        </div>
                    </div>
                }
            </div>
            @if (Model.ImaxMovies.Count > 8)
            {
                <div class="text-center">
                    <a href="/Movies?type=imax" class="btn btn-outline-primary">Xem thêm</a>
                </div>
            }
        </div>
    </div>
</div>


   <style>
   .movie-card-custom {
       border-radius: 20px;
       box-shadow: 0 4px 24px rgba(0,0,0,0.13);
       background: #181818;
   }
   .poster-wrapper {
       position: relative;
   }
   .movie-overlay-custom {
       position: absolute;
       top: 50%;
       left: 50%;
       transform: translate(-50%, -50%);
       width: 100%;
       z-index: 2;
       background: rgba(0,0,0,0.18);
       padding: 30px 0 20px 0;
       opacity: 0;
       transition: opacity 0.25s;
       pointer-events: none;
   }
   .poster-wrapper:hover .movie-overlay-custom {
       opacity: 1;
       pointer-events: auto;
   }
   .badge-group {
       z-index: 3;
   }
   .bg-orange {
       background: #ff9800 !important;
   }
   .card-title {
       font-size: 1.1rem;
       color: #fff;
   }
   .movie-card-custom .card-body {
       background: transparent;
   }
   .movie-card-custom .btn-danger {
       background: #c62828;
       border: none;
   }
   .movie-card-custom .btn-outline-light {
       border: 2px solid #fff;
   }
   .movie-card-custom .btn {
       font-size: 1.08rem;
       font-weight: 600;
   }
   </style>

<!-- Modal Trailer -->
<div class="modal fade" id="trailerModal" tabindex="-1" aria-labelledby="trailerModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content bg-dark">
      <div class="modal-header border-0">
        <h5 class="modal-title text-white" id="trailerModalLabel">Trailer</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" onclick="closeTrailer()"></button>
      </div>
      <div class="modal-body p-0" id="trailerModalBody" style="height:400px;">
        <!-- Video sẽ được nhúng ở đây -->
      </div>
    </div>
  </div>
</div>

<script>
function showTrailer(url) {
    let embedUrl = url;
    // Nếu là link YouTube, chuyển sang embed
    if (url.includes("youtube.com") || url.includes("youtu.be")) {
        const videoId = url.includes("youtu.be")
            ? url.split("youtu.be/")[1]
            : url.split("v=")[1].split("&")[0];
        embedUrl = "https://www.youtube.com/embed/" + videoId + "?autoplay=1";
    }
    document.getElementById('trailerModalBody').innerHTML =
        `<iframe width="100%" height="400" src="${embedUrl}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
    var myModal = new bootstrap.Modal(document.getElementById('trailerModal'));
    myModal.show();
}
function closeTrailer() {
    document.getElementById('trailerModalBody').innerHTML = "";
}
</script>